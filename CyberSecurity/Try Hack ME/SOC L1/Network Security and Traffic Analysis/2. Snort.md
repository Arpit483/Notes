
**Date** : 2025-07-22
**Link** :   https://tryhackme.com/room/snort
**Description** : Learn how to use Snort to detect real-time threats, analyse recorded traffic files and identify anomalies.

# Introduction

SNORT is an **open-source, rule-based** Network Intrusion Detection and Prevention System **(NIDS/NIPS)** . It was developed and still maintained by Martin Roesch, open-source contributors, and the Cisco Talos team. 

**[The official description](https://www.snort.org/):** _"Snort is the foremost Open Source Intrusion Prevention System (IPS) in the world. Snort IPS uses a series of rules that help define malicious network activity and uses those rules to find packets that match against them and generate alerts for users."_

# Interactive Material and VM

Deploy The machine

Everything you need is located under the "**Task-Exercises**" folder.

There are two sub-folders available:

- Config-Sample: Sample configuration and rule files. These files are provided to show what the configuration files look like. Installed Snort instance doesn't use them, so feel free to practice and modify them. Snort's original base files are located under **/etc/snort** folder.
- Exercise-Files: There are separate folders for each task. Each folder contains pcap, log and rule files ready to play with.

![](https://tryhackme-images.s3.amazonaws.com/user-uploads/6131132af49360005df01ae3/room-content/56e7b4aff9791dd79f280b9e18350499.png)

Traffic Generator

The machine is offline, but there is a script (traffic-generator.sh) for you to generate traffic to your snort interface. You will use this script to trigger traffic to the snort interface. Once you run the script, it will ask you to choose the exercise type and then automatically open another terminal to show you the output of the selected action.

**Note that each traffic is designed for a specific exercise. Make sure you start the snort instance and wait until to end of the script execution. Don't stop the traffic flood unless you choose the wrong exercise.** 

Run the "traffic generator.sh" file by executing it as sudo. 

executing the traffic generator script

```bash
user@ubuntu$ sudo ./traffic-generator.sh
```

General desktop overview. Traffic generator script in action.

![](https://tryhackme-images.s3.amazonaws.com/user-uploads/6131132af49360005df01ae3/room-content/a1f0fbcda5c475ae78da0dbd96267892.png)

Once you choose an action, the menu disappears and opens a terminal instance to show you the output of the action.

![](https://tryhackme-images.s3.amazonaws.com/user-uploads/6131132af49360005df01ae3/room-content/5550256e1a64efe83b33535f84147ec4.png)

Answer the questions below

### Questions

1. Navigate to the Task-Exercises folder and run the command "./.easy.sh" and write the output

![[Pasted image 20250723220757.png]]
**Ans** : Too easy!

# Introduction to IDS/IPS

![](https://tryhackme-images.s3.amazonaws.com/user-uploads/6131132af49360005df01ae3/room-content/31b95ee3f9f1f1ab86887a011f12edcb.png)

Before diving into Snort and analysing traffic, let's have a brief overview of what an Intrusion Detection System (IDS) and Intrusion Prevention System (IPS) is. It is possible to configure your network infrastructure and use both of them, but before starting to use any of them, let's learn the differences.

### **Intrusion Detection System (IDS)**

IDS is a passive monitoring solution for detecting possible malicious activities/patterns, abnormal incidents, and policy violations. It is responsible for generating alerts for each suspicious event. 

There are two main types of IDS systems;

- Network Intrusion Detection System (NIDS) - NIDS monitors the traffic flow from various areas of the network. The aim is to investigate the traffic on the entire subnet. If a signature is identified, an alert is created.
- Host-based Intrusion Detection System (HIDS) - HIDS monitors the traffic flow from a single endpoint device. The aim is to investigate the traffic on a particular device. If a signature is identified, an alert is created.

  
### **Intrusion Prevention System (IPS)**

IPS is an active protecting solution for preventing possible malicious activities/patterns, abnormal incidents, and policy violations. It is responsible for stopping/preventing/terminating the suspicious event as soon as the detection is performed.

 **There are four main types of IPS systems;**

- Network Intrusion Prevention System (NIPS) - NIPS monitors the traffic flow from various areas of the network. The aim is to protect the traffic on the entire subnet. If a signature is identified, the connection is terminated.
- Behaviour-based Intrusion Prevention System (Network Behaviour Analysis - NBA) - Behaviour-based systems monitor the traffic flow from various areas of the network. The aim is to protect the traffic on the entire subnet. If an anomaly is identified, **the connection is terminated.**

Network Behaviour Analysis System works similar to NIPS. The difference between NIPS and Behaviour-based is that behaviour based systems require a training period (also known as "baselining") to learn the normal traffic and differentiate the malicious traffic and threats. This model provides more efficient results against new and unknown threats.  

The system is trained to know the "normal" to detect "abnormal". The training period is crucial to avoid any false positives. In case of any security breach during the training period, the results will be highly problematic. Another critical point is to ensure that the system is well trained to recognise benign activities.   

- Wireless Intrusion Prevention System (WIPS) - WIPS monitors the traffic flow from of wireless network. The aim is to protect the wireless traffic and stop possible attacks launched from there. If a signature is identified, the connection is terminated.
- Host-based Intrusion Prevention System (HIPS) - HIPS actively protects the traffic flow from a single endpoint device. The aim is to investigate the traffic on a particular device. If a signature is identified, **the connection is terminated.**

HIPS working mechanism is similar to HIDS. The difference between them is that **while HIDS creates alerts for threats,** **HIPS stops the threats by terminating the connection.**



### Detection/Prevention Techniques

There are three main detection and prevention techniques used in IDS and IPS solutions;

|                  |                                                                                                                                                                                                                        |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Technique**    | **Approach**                                                                                                                                                                                                           |
| Signature-Based  | This technique relies on rules that identify the specific patterns of the known malicious behaviour. This model helps detect known threats.                                                                            |
| Behaviour-Based  | This technique identifies new threats with new patterns that pass through signatures. The model compares the known/normal with unknown/abnormal behaviours. This model helps detect previously unknown or new threats. |
| **Policy-Based** | This technique compares detected activities with system configuration and security policies. This model helps detect policy violations.                                                                                |

  
Summary  

**Phew!** That was a long ride and lots of information. Let's summarise the overall functions of the IDS and IPS in a nutshell.

- **IDS** can identify threats but require user assistance to stop them.
- **IPS** can identify and block the threats with less user assistance at the detection time.  
    

**Now let's talk about Snort. [Here is the rest of the official description](https://www.snort.org/) of the snort;**


_Snort can be deployed inline to stop these packets, as well. Snort has three primary uses: As a packet sniffer like tcpdump, as a packet logger — which is useful for network traffic debugging, or it can be used as a full-blown network intrusion prevention system. Snort can be downloaded and configured for personal and business use alike."_  

SNORT is an open-source, rule-based Network Intrusion Detection and Prevention System (NIDS/NIPS). It was developed and still maintained by Martin Roesch, open-source contributors, and the Cisco Talos team. 

Capabilities of Snort;  

- Live traffic analysis
- Attack and probe detection
- Packet logging
- Protocol analysis
- Real-time alerting
- Modules & plugins
- Pre-processors
- Cross-platform support! (Linux & Windows)

Snort has three main use models;  

- Sniffer Mode - Read IP packets and prompt them in the console application.
- Packet Logger Mode - Log all IP packets (inbound and outbound) that visit the network.
- NIDS (Network Intrusion Detection System)  and NIPS (Network Intrusion Prevention System) Modes - Log/drop the packets that are deemed as malicious according to the user-defined rules.

### Answer The Questions

1. Which IDS or IPS type can help you stop the threats on a local machine?
   -> HIPS

2. Which IDS or IPS type can help you detect threats on a local network?
   -> NIDS

3. Which IDS or IPS type can help you detect the threats on a local machine?
   -> HIDS

4. Which IDS or IPS type can help you stop the threats on a local network?
   -> NIPS

5. Which described solution works by detecting anomalies in the network?
   -> NBA

6. According to the official description of the snort, what kind of NIPS is it?
   -> Full-blown

7. NBA training period is also known as ..
   -> baselining

# First Interaction with Snort
   
Check Weather Snort exists or not 
```shell-session
snort -V
```
Before getting your hands dirty, we should ensure our configuration file is valid.  
Here **"-T"** is used for testing configuration, and **"-c"** is identifying the configuration file **(snort.conf)**.  
Note that it is possible to use an additional configuration file by pointing it with **"-c"**.

```shell-session
sudo snort -c /etc/snort/snort.conf -T 
```

Once we use a configuration file, snort got much more power! The configuration file is an all-in-one management file of the snort. Rules, plugins, detection mechanisms, default actions and output settings are identified here. It is possible to have multiple configuration files for different purposes and cases but can only use one at runtime.

Note that every time you start the Snort, it will automatically show the default banner and initial information about your setup. You can prevent this by using the " **-q"**  parameter.

|                    |                                                                                                        |
| ------------------ | ------------------------------------------------------------------------------------------------------ |
| **Parameter**      | **Description**                                                                                        |
| **-V / --version** | This parameter provides information about your instance version.                                       |
| **-c**             | Identifying the configuration file                                                                     |
| **-T**             | Snort's self-test parameter, you can test your setup with this parameter.                              |
| - **q**            | Quiet mode prevents snort from displaying the default banner and initial information about your setup. |

### Answer the questions below

1. Run the Snort instance and check the build number.
	-> 149 (Use Command `snort -V` and find the current build number)

2. Test the current instance with "/etc/snort/snort.conf" file and check how many rules are loaded with the current build.
   ![[Pasted image 20250723230252.png]]
		Ans  : 4151

3. Test the current instance with "/etc/snort/snortv2.conf" file and check how many rules are loaded with the current build.
   ->  1


# Operation Mode 1: Sniffer Mode


![](https://tryhackme-images.s3.amazonaws.com/user-uploads/6131132af49360005df01ae3/room-content/2aa652d7bd97f99e25dbe7bf173d5c41.png)  

**Let's run Snort in Sniffer Mode**

ke tcpdump, Snort has various flags capable of viewing various data about the packet it is ingesting.  

Sniffer mode parameters are explained in the table below;

| **Parameter** | **Description**                                                                                                                                               |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **-v**        | Verbose. Display the TCP/IP output in the console.                                                                                                            |
| **-d**        | Display the packet data (payload).                                                                                                                            |
| **-e**        | Display the link-layer (TCP/IP/UDP/ICMP) headers.                                                                                                             |
| -**X**        | Display the full packet details in HEX.                                                                                                                       |
| -**i**        | This parameter helps to define a specific network interface to listen/sniff. Once you have multiple interfaces, you can choose a specific interface to sniff. |
Let's start using each parameter and see the difference between them. Snort needs active traffic on your interface, so we need to generate traffic to see Snort in action.  

To do this, use **the traffic-generator** script (find this in the Task-Exercise folder)  

  
**Sniffing with parameter "-i"**  

Start the Snort instance in **verbose mode (-v)** and **use the interface (-i)** "eth0"; `sudo snort -v -i eth0`

In case you have only one interface, Snort uses it by default. The above example demonstrates to sniff on the interface named "eth0". Once you simulate the parameter -v, you will notice it will automatically use the "eth0" interface and prompt it.

**Sniffing with parameter "-v"**  

Start the Snort instance in **verbose mode (-v)**; `sudo snort -v`

Now run the traffic-generator script as sudo and start **ICMP/HTTP traffic**. Once the traffic is generated, snort will start showing the  packets in verbosity mode as follows;


**Sniffing with parameter "-d"**  

Start the Snort instance in **dumping packet data mode (-d)**; `sudo snort -d`

**Sniffing with parameter "-de"**

Start the Snort instance in **dump (-d)** and **link-layer header grabbing (-e)** mode; `snort -d -e`

**Sniffing with parameter "-X"  

Start the Snort instance in **full packet dump mode (-X)**; `sudo snort -X`

Note that you can use the parameters both in combined and separated form as follows;**  

- **snort -v**
- **snort -vd**
- **snort -de**
- **snort -v -d -e**
- **snort -X**

# Operation Mode 2: Packet Logger Mode

Running Snort In Logger Mode

You can use Snort as a sniffer and log the sniffed packets via logger mode. You only need to use the packet logger mode parameters, and Snort does the rest to accomplish this.

Packet logger parameters are explained in the table below;

| **Parameter** | **Description**                                                                                                                                                              |
| ------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| -l            | Logger mode, target **log and alert** output directory. Default output folder is **/var/log/snort**<br>The default action is to dump as tcpdump format in **/var/log/snort** |
| **-K ASCII**  | Log packets in ASCII format.                                                                                                                                                 |
| -r            | Reading option, read the dumped logs in Snort.                                                                                                                               |
| **-n**        | Specify the number of packets that will process/read. Snort will stop after reading the specified number of packets.                                                         |
|               |                                                                                                                                                                              |

Let's start using each parameter and see the difference between them. Snort needs active traffic on your interface, so we need to generate traffic to see Snort in action.

## Logfile Ownership


Before generating logs and investigating them, we must remember the Linux file ownership and permissions. No need to deep dive into user types and permissions. The fundamental file ownership rule; **whoever creates a file becomes the owner of the corresponding file**.  

Snort needs superuser (root) rights to sniff the traffic, so once you run the snort with the "sudo" command, the "**root" account will own the generated log files**. Therefore you will need "root" rights to investigate the log files. There are two different approaches to investigate the generated log files;  
  

- **Elevation of privileges** **-** You can elevate your privileges to examine the files. You can use the "sudo" command to execute your command as a superuser with the following command `sudo command`. You can also elevate the session privileges and switch to the superuser account to examine the generated log files with the following command: `sudo su`

- **Changing the ownership of files/directories** - You can also change the ownership of the file/folder to read it as your user: `sudo chown username file` or `sudo chown username -R directory` 
  The "-R" parameter helps recursively process the files and directories.

## Logging with parameter "-l"

First, start the Snort instance in packet logger mode;  `sudo snort -dev -l .`
The `-l .` part of the command creates the logs in the current directory.
Use `sudo snort -dev -l .` to run network analysis
![[Pasted image 20250724121745.png]]

## Logging with parameter "-K ASCII"  

Start the Snort instance in packet logger mode; 
`sudo snort -dev -K ASCII -l .`
Now run the traffic-generator script as sudo and start ICMP/HTTP traffic. Once the traffic is generated, Snort will start showing the  packets in verbosity mode as follows;

One run  3 folder will be created with name as ip addresses as shown below

![[Pasted image 20250724122304.png]]

In a nutshell, ASCII mode provides multiple files in human-readable format, so it is possible to read the logs easily by using a text editor. By contrast with ASCII format, binary format is not human-readable and requires analysis using Snort or an application like tcpdump



## Reading generated logs with parameter "-r"

`sudo snort -r filename.log`
Can be used to read snort log documents

**Note that** Snort can read and handle the binary like output (tcpdump and Wireshark also can handle this log format). However, if you create logs with "-K ASCII" parameter, Snort will not read them. Snort read and displayed the log file just like in the sniffer mode.

Opening log file with tcpdump.
```shell
sudo tcpdump -r snort.log.1753339655 -ntc 10
```
Opening log file with Wireshark.  

![](https://tryhackme-images.s3.amazonaws.com/user-uploads/6131132af49360005df01ae3/room-content/a4bd8447760481cd2f6f9762a9620a50.png)

"-r" parameter also allows users to filter the binary log files. **You can filter the processed log to see specific packets with the "-r" parameter and Berkeley Packet Filters (BPF).** 

- `sudo snort -r logname.log -X`
- `sudo snort -r logname.log icmp`
- `sudo snort -r logname.log tcp`
- `sudo snort -r logname.log 'udp and port 53'`

The output will be the same as the above, but only packets with the chosen protocol will be shown. Additionally, you can specify the number of processes with the parameter "-n". **The following command will process only the first 10 packets:** `snort -dvr logname.log -n 10`

Please use the following resources to understand how the BPF works and its use.  

- [https://en.wikipedia.org/wiki/Berkeley_Packet_Filter](https://en.wikipedia.org/wiki/Berkeley_Packet_Filter)
- [https://biot.com/capstats/bpf.html](https://biot.com/capstats/bpf.html)
- [https://www.tcpdump.org/manpages/tcpdump.1.html](https://www.tcpdump.org/manpages/tcpdump.1.html)


## Questions

### 1 . Investigate the traffic with the default configuration file with ASCII mode.  
`sudo snort -dev -K ASCII -l .`
Execute the traffic generator script and choose "TASK-6 Exercise". Wait until the traffic ends, then stop the Snort instance. Now analyse the output summary and answer the question.
`sudo ./traffic-generator.sh`
Now, you should have the logs in the current directory. Navigate to folder "145.254.160.237". What is the source port used to connect port 53?

First run `sudo snort -dev -K ASCII -l .`

Run the traffic generator script as admin
```shell
sudo ./traffic-generator.sh
```

after this se get a folder name **145.254.160.237**

`cd 145.254.160.237`


![[Pasted image 20250724123816.png]]

Ans  : 3009

### Use snort.log.1640048004   

Read the snort.log file with Snort; what is the IP ID of the 10th packet?

`snort -r snort.log.1640048004 -n 10`
This command will run until 10 packets are analyzed so on the last packet we will get the req answer

![[Pasted image 20250724124413.png]]

Ans : 49313

### Read the "**snort.log.1640048004"** file with Snort; what is the referer of the 4th packet?

use the command
```shell
sudo snort -r snort.log.1640048004 -n 4 -X
```
![[Pasted image 20250724125045.png]]

### Read the "**snort.log.1640048004"** file with Snort; what is the Ack number of the 8th packet?  
 Ans : 0x38AFFFF3

### Read the "**snort.log.1640048004"** file with Snort; what is the number of the **"TCP port 80"** packets?
Ans : 41


# Operation Mode 3: IDS/IPS

