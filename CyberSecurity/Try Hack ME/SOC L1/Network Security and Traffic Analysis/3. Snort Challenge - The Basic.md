**Date** : 2025-07-28
**Link** :   https://tryhackme.com/room/snortchallenges1
**Description** : Put your snort skills into practice and write snort rules to analyse live capture network traffic.

Refer [[2. Snort]] For this challenge

# Writing IDS Rules (HTTP)

## Answer the questions below

1. Navigate to the task folder and use the given pcap file.  Write a rule to detect all TCP packets **from or to** port 80.  What is the number of detected packets you got?  Note: You must answer this question correctly before answering the rest of the questions.

Ans : 
Use the rule :  `alert tcp any any <> any 80 (msg:"OHH"; sid:1000001; rev:1;)`

and edit it in the local.rules files
```shell
sudo gedit local.rules
```
![[Pasted image 20250728233324.png]]

once edited run snort
```shell
snort -c local.rules -A full -l . -r mx-3.pcap 
```

To view the snort file we use 
```shell
sudo snort -r snort.log.1753725473 
```

![[Pasted image 20250728233352.png]]
And we have our answer 
**Ans**  : 164


2. Investigate the log file.  What is the destination address of packet 63?
To view this use the command
```shell
sudo snort -r snort.log.1753725473 -n 63
```
The -n parameter ensures that only packets up to 63.

![[Pasted image 20250728233850.png]]
**Ans** : 216.239.59.99

3. Investigate the log file.  What is the ACK number of packet 64?
```shell
sudo snort -r snort.log.1753725473  -n 64
```
![[Pasted image 20250728234040.png]]

**Ans** : 0x2E6B5384

4. Investigate the log file.  What is the SEQ number of packet 62?

```shell
sudo snort -r snort.log.1753725473  -n 64
```

![[Pasted image 20250728234130.png]]

**Ans** : 0x36C21E28

5. Investigate the log file.  What is the TTL of packet 65?

```shell
sudo snort -r snort.log.1753725473  -n 65
```

![[Pasted image 20250728234348.png]]

**Ans:** 128

6. Investigate the log file.  What is the source IP of packet 65?

**Ans**: 145.254.160.237

7. Investigate the log file.  What is the source port of packet 65?

**Ans** : 3372




# Writing IDS Rules (FTP)

## Answer the questions below

1. Use the given pcap file.  Write a **single** rule to detect "**all TCP port 21**"  traffic in the given pcap.  What is the number of detected packets?

**Rule** : `alert tcp any any <> any 21 (msg : "Source" ; sid:1000001 ; rev:1;)`

```shell
 sudo snort -c local.rules -A full -l . -r ftp-png-gif.pcap 
```

```shell
sudo snort -r snort.log.1753725473 
```
![[Pasted image 20250728235503.png]]

**Ans** : 307

2. Investigate the log file.  What is the FTP service name?

```shell
 strings snort.log.1753727012
```

![[Pasted image 20250729000352.png]]

**Ans**: Microsoft FTP Service

3. Deactivate/comment on the old rules. Write a rule to detect failed FTP login attempts in the given pcap.  What is the number of detected packets?

Rule : `alert tcp any any <> any 21 (msg : "Source" ; content:"530" ; sid:1000001 ; rev:1;)`

Run it 
```shell
snort -c local.rules -A full -l . -r ftp-png-gif.pcap
```

![[Pasted image 20250729001209.png]]

**Ans** : 41 


4. Write a rule to detect successful FTP logins in the given pcap. What is the number of detected packets?

Rule : `alert tcp any any <> any 21 (msg : "Source" ; content:"230" ; sid:1000001 ; rev:1;)`

Run it
![[Pasted image 20250729001453.png]]

**Ans** : 1


5. Write a rule to detect FTP login attempts with a valid username but no password entered yet. What is the number of detected packets?

Rule : `alert tcp any any <> any 21 (msg : "Source" ; content:"331" ; sid:1000001 ; rev:1;)`
![[Pasted image 20250729001724.png]]

**Ans:** 42

6. Write a rule to detect FTP login attempts with the "Administrator" username but no password entered yet. What is the number of detected packets?

Rule : `alert tcp any any -> any 21 (msg:"FTP login attempt with 'Administrator' username"; content:"USER Administrator"; nocase; sid:1000003; rev:1;)`
![[Pasted image 20250729002030.png]]
**Ans :** 7

# Writing IDS Rules (PNG)

## Answer the questions below 

1. Write a rule to detect the PNG file in the given pcap. Investigate the logs and identify the software name embedded in the packet.

Rule : `alert tcp any any -> any any (msg:"PNG file detected"; content:"|89 50 4E 47 0D 0A 1A 0A|"; sid:1000004; rev:1;)`
```shell
sudo snort -r snort.log.1753729993 -X
```

![[Pasted image 20250729004910.png]]

**Ans**: Adobe ImageReady

2. Write a rule to detect the GIF file in the given pcap. Investigate the logs and identify the image format embedded in the packet.
Rule : `alert tcp any any -> any any (msg:"PNG file detected"; content:"GIF89a"; sid:1000004; rev:1;)`
![[Pasted image 20250729005329.png]]

Ans : GIF89a





# Writing IDS Rules (Torrent Metafile)

## Answer the questions below

1. Use the given pcap file. Write a rule to detect the torrent metafile in the given pcap. What is the number of detected packets?

Rule : `alert tcp any any <> any any (msg:"Torrent" ; content:".torrent" ; sid:1000001 ; rev:1;)`

```shell
snort -c local.rules -A full -l . -r torrent.pcap 
```

![[Pasted image 20250729225023.png]]


**Ans** : 2

2. Investigate the log/alarm files. What is the name of the torrent application?

```bash
snort -r snort.log.1753809650 -X
```

![[Pasted image 20250729225658.png]]

**Ans** : bittorrent

3. Investigate the log/alarm files. What is the MIME (Multipurpose Internet Mail Extensions) type of the torrent metafile?
**Ans** : application/x-bittorrent

4. What is the hostname of the torrent metafile?
**Ans:** tracker2.torrentbox.com


# Troubleshooting Rule Syntax Errors
## Answer the questions below

*In this section, you need to fix the syntax errors in the given rule files.*

1.  You can test each ruleset with the following command structure;
`sudo snort -c local-X.rules -r mx-1.pcap -A console`
Fix the syntax error in local-1.rules file and make it work smoothly. What is the number of the detected packets?

Rule : `alert tcp any 3372 -> any any (msg:"Troubleshooting 1"; sid:1000001; rev:1;)`

![[Pasted image 20250729230700.png]]

**Ans :** 16

2. Fix the syntax error in local-2.rules file and make it work smoothly. What is the number of the detected packets?

Rule : `alert icmp any any -> any any (msg:"Troubleshooting 2"; sid:1000001; rev:1;)`

Ans : 68

3. Fix the syntax error in local-3.rules file and make it work smoothly. What is the number of the detected packets?

Rule : `alert icmp any any -> any any (msg: "ICMP Packet Found"; sid:1000001; rev:1;)
`alert tcp any any -> any [80,443] (msg: "HTTPX Packet Found"; sid:1000002; rev:1;)`
![[Pasted image 20250729231138.png]]
**Ans** : 87

4. Fix the syntax error in local-4.rules file and make it work smoothly. What is the number of the detected packets?

Rule : `alert icmp any any -> any any (msg: "ICMP Packet Found"; sid:1000001; rev:1;)
`alert tcp any [80,443] -> any any (msg: "HTTPX Packet Found"; sid:1000002; rev:1;)`

![[Pasted image 20250729231349.png]]

**Ans** : 90 

5. Fix the syntax error in local-5.rules file and make it work smoothly. What is the number of the detected packets?

Rule :
`alert icmp any any <> any any (msg: "ICMP Packet Found"; sid:1000001; rev:1;)
`alert icmp any any <> any any (msg: "Inbound ICMP Packet Found"; sid:1000002; rev:1;)
`alert tcp any any -> any [80,443] (msg: "HTTPX Packet Found"; sid:1000003; rev:1;)`

![[Pasted image 20250729231709.png]]

**Ans**: 155


6. Fix the logical error in local-6.rules file and make it work smoothly to create alerts. What is the number of the detected packets?

Rule : `alert tcp any any <> any 80 (msg: "GET Request Found"; content:"|47 45 54|"; sid: 100001; rev:1;)`

![[Pasted image 20250729232104.png]]

**Ans :** 2


7. Fix the logical error in local-7.rules file and make it work smoothly to create alerts. What is the name of the required option:
![[Pasted image 20250729232211.png]]

Obviously msg is missing

**Ans :** msg

# Using External Rules (MS17-010)
## Answer the questions below

1. Use the given pcap file. Use the given rule file (local.rules) to investigate the ms1710 exploitation. What is the number of detected packets?
```shell
sudo snort -c local.rules -r ms-17-010.pcap -A console
```

![[Pasted image 20250729234015.png]]

**Ans** : 25154

2. Use local-1.rules empty file to write a new rule to detect payloads containing the "\IPC$" keyword. What is the number of detected packets?

Rule : `alert tcp any any -> any 445 (msg: "Exploit Detected!"; flow: to_server, established; content: "IPC$";sid: 20244225; rev:3;)`

Ans : 12
